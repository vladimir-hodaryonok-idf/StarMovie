name: main_pull_request

on:
  pull_request:
    types: [ opened, reopened ]
    branches:
      - master
jobs:
  pull_request_opened:
    name: Pull request to master
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-java@v1
      with:
        java-version: '11'
    - uses: subosito/flutter-action@v1
      with:
        flutter-version: '3.0.5'
        channel: 'stable'
    - run: touch "keys_prod.json";
    - run: echo "{\"traktApiKey\":\"90ab4446135b42228a9c1a0957788ec82de5b5df568915903a319e02938227cc\",\"omdbApiKey\":\"5e582eee\",\"tmdbApiKey\":\"c8e25ea9a912cc6edfd3f4f87e1ee8cf\"}" >> test.json;
    - run: cd android
    - run: echo "facebook_app_id=504363714516184" >> local.properties;
    - run: echo "fb_login_protocol_scheme=fb504363714516184" >> local.properties;
    - run: echo "facebook_client_token=034b33121c13d5bfa49775ae9dd73ec4test" >> local.properties;
    - run: cat local.properties;
    - run: cd ..
    - run: flutter pub get
    - run: flutter build appbundle --flavor Prod
    - name: Push APK to Releases
      uses: ncipollo/release-action@v1
      with:
        artifacts: "build/app/outputs/apk/debug/*.apk"
